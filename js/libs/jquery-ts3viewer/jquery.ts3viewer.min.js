/*!
 * jQuery TS3 Viewer v1.0.0
 * https://www.planetteamspeak.com
 *
 * Copyright (c) Planet TeamSpeak. All rights reserved.
 * Released under the MIT license.
 */
!function(e){e.fn.tsviewer=function(s){e.fn.tsviewer.element=this,e.fn.tsviewer.options=e.extend({},e.fn.tsviewer.options,s),e.fn.tsviewer.init(),e.fn.tsviewer.hook()},e.fn.tsviewer.element=null,e.fn.tsviewer.options={host:null,port:null,iconUrl:"https://api.planetteamspeak.com/servericon/$host:$port/?id=$icon&img=1",dataUrl:"https://api.planetteamspeak.com/servernodes/$host:$port/",serverTip:"",channelTip:"",clientTip:"",onNode:function(){},onReady:function(){},onError:function(){}},e.fn.tsviewer.init=function(){e.fn.tsviewer.element.html('<ul id="tsv-container-ts3" class="tsv-container"></ul>'),e.fn.tsviewer.options.iconUrl=e.fn.tsviewer.options.iconUrl.replace("$host",e.fn.tsviewer.options.host).replace("$port",e.fn.tsviewer.options.port),e.fn.tsviewer.options.dataUrl=e.fn.tsviewer.options.dataUrl.replace("$host",e.fn.tsviewer.options.host).replace("$port",e.fn.tsviewer.options.port),e.fn.tsviewer.refresh(!0)},e.fn.tsviewer.refresh=function(s){var t=e.ajax(e.fn.tsviewer.options.dataUrl);s===!0&&e("#tsv-container-ts3").html('<li id="tsv-node-loader" class="tsv-node loader"><div class="tsv-icon tsv-loader"></div><span class="tsv-name">Loading ...</span></li>'),t.done(function(s,t,n){if("success"!==s.status||!e.isArray(s.result.data))return e.fn.tsviewer.error(n,s.result.message);e("#tsv-container-ts3").html("");for(var i=0;i<s.result.data.length;i++)e.fn.tsviewer.render(s.result.data[i],i);e.fn.tsviewer.options.onReady.call(this,s.result.data,i)}),t.fail(function(s){return e.fn.tsviewer.error(s,"failed to retrieve tsviewer data")})},e.fn.tsviewer.expand=function(){e.fn.tsviewer.element.find(".tsv-sibling.collapsed").each(function(){e(this).parents(".tsv-wrapper").siblings("ul").show(),e(this).toggleClass("expanded"),e(this).toggleClass("collapsed")})},e.fn.tsviewer.collapse=function(){e.fn.tsviewer.element.find(".tsv-sibling.expanded").each(function(){e(this).parents(".tsv-wrapper").siblings("ul").hide(),e(this).toggleClass("expanded"),e(this).toggleClass("collapsed")})},e.fn.tsviewer.hook=function(){e.fn.tsviewer.element.on("click",".tsv-sibling.expanded, .tsv-sibling.collapsed",function(){e(this).parents(".tsv-wrapper").siblings("ul").toggle(),e(this).toggleClass("expanded"),e(this).toggleClass("collapsed")})},e.fn.tsviewer.render=function(s,t){if("channel"===s["class"]&&128&s.props.flags)if(s["class"]="spacer "+s.props.spacer.replace("custom",""),"custom"!==s.props.spacer.substr(0,6))s.name="";else if(s.name.length&&"repeat"===s.props.spacer.substr(s.props.spacer.length-6))for(;s.name.length<256;)s.name+=s.name;var n=e('<li id="tsv-node-'+s.ident+'" class="tsv-node '+s["class"]+" tsv-"+(t%2?"row2":"row1")+'" data-id="'+s.props.id+'"></li>');e("#tsv-container-"+s.parent).append(n);var i=e('<div class="tsv-wrapper"></div>'),r=e('<div class="tsv-'+s["class"]+'"></div>'),a=e('<div class="tsv-infos"></div>'),o=e('<div class="tsv-icons"></div>'),l="";n.append(i),n.append('<div class="tsv-clear"></div>'),i.append(r),r.append(a),r.append(o);for(var p=0;p<s.siblings.length;p++)a.append('<div class="tsv-sibling '+(s.siblings[p]?"tsv-sibling-line":"tsv-sibling-blank")+'"></div>');if(s.level>1&&a.append('<div class="tsv-sibling '+(s.last?"tsv-sibling-end":"tsv-sibling-mid")+(s.children>0?" expanded":"")+'"></div>'),"spacer"!==s["class"].substr(0,6)&&("channel"===s["class"]&&64&s.props.flags&&(s.image+="-subscribed"),a.append('<div class="tsv-icon tsv-'+s.image+'"></div>')),"server"===s["class"])l+=e.fn.tsviewer.options.serverTip;else if("channel"===s["class"])1&s.props.flags&&o.append('<div class="tsv-icon tsv-channel-flag-default" title="Default Channel"></div>'),2&s.props.flags&&o.append('<div class="tsv-icon tsv-channel-flag-password" title="Password-protected"></div>'),16&s.props.flags&&o.append('<div class="tsv-icon tsv-channel-flag-music" title="Music Codec"></div>'),32&s.props.flags&&o.append('<div class="tsv-icon tsv-channel-flag-moderated" title="Moderated"></div>'),s.props.codec=e.fn.tsviewer.codec(s.props.codec),l+=e.fn.tsviewer.options.channelTip;else if("client"===s["class"]){8&s.props.flags&&o.append('<div class="tsv-icon tsv-client-priority" title="Priority Speaker"></div>'),4&s.props.flags&&o.append('<div class="tsv-icon tsv-client-cc" title="Channel Commander"></div>'),16&s.props.flags&&o.append('<div class="tsv-icon tsv-client-talker" title="Talk Power granted"></div>'),32&s.props.flags&&o.append('<div class="tsv-icon tsv-client-mic-muted" title="Insufficient Talk Power"></div>');for(var p=0;p<s.props.memberof.length;p++)o.append(e.fn.tsviewer.icon(s.props.memberof[p].icon,e("<div />").text(s.props.memberof[p].name).html()+" ["+(32&s.props.memberof[p].flags?"Server":"Channel")+" Group]"));l+=e.fn.tsviewer.options.clientTip}if(l.length)for(var v in s.props)l=l.replace("$"+v,s.props[v]);o.append(e.fn.tsviewer.icon(s.props.icon,s["class"].charAt(0).toUpperCase()+s["class"].slice(1)+" Icon")),a.append('<span class="tsv-name"'+(l.length?' title="'+l+'"':"")+">"+(s.name?e("<div />").text(s.name).html():"&nbsp;")+"</span>"),e.fn.tsviewer.width(r,o),e.fn.tsviewer.options.onNode.call(this,n,s),s.children>0&&n.append('<ul id="tsv-container-'+s.ident+'" class="tsv-container"></ul>')},e.fn.tsviewer.base=function(){},e.fn.tsviewer.icon=function(s,t){return s>0?1e3>s?'<div class="tsv-icon tsv-group-'+s+'" title="'+t+'"></div>':'<div class="tsv-icon" style="background: url(\''+e.fn.tsviewer.options.iconUrl.replace("$icon",s)+'\') 0 0/contain no-repeat" title="'+t+'"></div>':""},e.fn.tsviewer.codec=function(e){return 0===e?"Speex Narrowband":1===e?"Speex Wideband":2===e?"Speex Ultra-Wideband":3===e?"CELT Mono":4===e?"Opus Voice":5===e?"Opus Music":e},e.fn.tsviewer.width=function(e,s){var t=s.width();e.css({marginRight:t}),s.css({marginRight:-t,width:t})},e.fn.tsviewer.error=function(s,t){e.fn.tsviewer.options.onError.call(this,t),e("#tsv-container-ts3").html('<li id="tsv-node-error" class="tsv-node error"><div class="tsv-icon tsv-error" title="ERROR, '+t.toLowerCase()+'"></div><span class="tsv-name">'+e.fn.tsviewer.options.host+":"+e.fn.tsviewer.options.port+"</span></li>")},e.fn.tsviewerRefresh=function(s){e.fn.tsviewer.element&&e.fn.tsviewer.refresh(s)},e.fn.tsviewerExpand=function(){e.fn.tsviewer.element&&e.fn.tsviewer.expand()},e.fn.tsviewerCollapse=function(){e.fn.tsviewer.element&&e.fn.tsviewer.collapse()}}(jQuery);
