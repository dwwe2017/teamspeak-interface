var SERVER_URL="./index.php",getJsonRequest=function(a,b){$.ajax({url:SERVER_URL+"?controller=ajax&action=instanceNotes&id="+id,data:a,error:function(a){},success:function(a){"success"===a.status?null!=b&&b(a.message):null!=b&&b(null)},type:"POST"})},externalManager={test:function(a){getJsonRequest("option=test",function(b){null!==b?a(!0):a(!1)})},add:function(a,b){var c="PostIt_"+parseInt(a.id,10);a=encodeURIComponent(JSON.stringify(a));getJsonRequest("option=add&key="+c+"&content="+a,b)},get:function(a,
b){var c;a="PostIt_"+parseInt(a,10);getJsonRequest("option=get&key="+a,function(a){try{c=JSON.parse(a)}catch(d){c=""}null!=b&&b(c)})},remove:function(a,b){a="PostIt_"+parseInt(a,10);getJsonRequest("option=remove&key="+a,b)},removeDom:function(a,b){var c=0,f=!1;if(void 0===a||"function"===typeof a)b=a,a={domain:window.location.origin,page:window.location.pathname};var d=a.domain,h=a.page,g=this;g.getlength(function(a){if(a)for(var e=1;e<=a;e++)g.key(e,function(e){g.getByKey(e,function(e){null!=e&&
(f="domain"===$.fn.postitall.globals.filter?getUrl(e.domain)===getUrl(d):"page"===$.fn.postitall.globals.filter?getUrl(e.domain)===getUrl(d)&&(e.page===h||void 0===h):!0)&&g.remove(e.id);c===a-1&&null!=b&&(b(),b=null);c++})});else b()})},clear:function(a){var b=0,c=this;c.getlength(function(f){if(f)for(var d=1;d<=f;d++)c.key(d,function(d){c.getByKey(d,function(d){null!=d&&c.remove(d.id);b===f-1&&null!=a&&(a(),a=null);b++})});else a()})},getlength:function(a){getJsonRequest("option=getlength",function(b){a(b)})},
key:function(a,b){a--;getJsonRequest("option=key&key="+a,function(a){a?b(a):b("")})},view:function(){getJsonRequest("option=getByKey&key="+key,function(a){})},getByKey:function(a,b){null!=a&&"PostIt_"===a.slice(0,7)?(a=a.slice(7,a.length),getJsonRequest("option=getByKey&key="+a,b)):null!=b&&b(null)},getAll:function(a){getJsonRequest("option=getAll",a)}};
