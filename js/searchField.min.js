(function(a){var f,g;a.fn.advancedSearchField=function(p){function q(){a("#s").hideTip();a("#search-result").fadeOut()}function e(){var b=a("#search-result"),d=a.trim(a("#s").val());if(0==d.length)a("#s").showTip({content:c.tipFocus}),b.fadeOut();else if(d.length<c.minSearchLength)a("#s").showTip({content:c.tipTooShort}),b.fadeOut();else{var k=a("#search-last").val();a("#search-info");a("#s").hideTip();b.fadeIn();k!=d&&(a("#search-last").val(d),f&&clearTimeout(f),b.children().not(".arrow, #server-search, #search-info").remove(),
c.enableNavSearch&&(b.children(".arrow:first").after("<h2>"+c.titleTemplateResult+"</h2>"+r(d)+"<hr>"),a.fn.accessibleList&&(0<c.moreButtonAfter||0<c.matchesPerPage)&&b.children("ul:first").accessibleList({moreAfter:c.moreButtonAfter,pageSize:c.matchesPerPage,after:function(){a("#s").focus()}})),a("#search-info").addClass("loading").text(c.messageLoading),f=setTimeout(t,c.firstRequestDelay))}}function r(b){var d=b.toLowerCase().split(/\s+/),k=d.length,l=[];a("nav a").each(function(b){var c=a(this).text().toLowerCase(),
e=!0;for(b=0;b<k;++b)if(-1==c.indexOf(d[b])){e=!1;break}e&&l.push(this)});b=l.length;if(0<b){var f='<p class="results-count"><strong>'+b+"</strong> match"+(1<b?"es":"")+'</p><ul class="small-files-list icon-html">';for(var m=0;m<b;++m){for(var h=a(l[m]),n=h.text(),g=[n],e=0;e<k;++e)n=n.replace(new RegExp("("+d[e]+")","gi"),"<strong>$1</strong>");for(;(h=h.parent().parent().prev("a"))&&0<h.length;)g.push(h.text());f+='<li><a href="'+l[m].href+'">'+n+"<br><small>"+g.reverse().join(" > ")+"</small></a></li>"}return f+
"</ul>"}return'<p class="results-count">'+c.messageNoMatches+"</p>"}function t(){var b=a("#s").parents("form:first").attr("action");b&&""!=b||(b=document.location.href.match(/^([^#]+)/)[1]);var d=(new Date).getTime();a("#server-search").load(b,{s:a("#search-last").val(),timer:d},function(b,d,e){"success"==d||"notmodified"==d?a("#search-info").removeClass("loading").html(c.messageSearchDone):(a("#server-search").html('<p class="error-message">'+c.messageErrorFull+"</p>"),a("#search-info").removeClass("loading").html(c.messageError))})}
var c=a.extend({},a.fn.advancedSearchField.defaults,p);this.before('<input type="hidden" name="search-last" id="search-last" value="">').focus(function(){g&&clearTimeout(g);a(this).bind("keyup",e);e()}).blur(function(){a(this).unbind("keyup",e);g=setTimeout(q,500)}).after('<div id="search-result" class="result-block"><span class="arrow"><span></span></span><div id="server-search">'+c.messageLoading+'</div><p id="search-info" class="result-info">-</p></div>').next().hide();return this};a.fn.advancedSearchField.defaults=
{minSearchLength:2,moreButtonAfter:3,matchesPerPage:5,firstRequestDelay:250,nextRequestDelay:750,noUpdateDelay:3E3,enableNavSearch:!0,tipFocus:"Enter your search",tipTooShort:"Enter at least 2 chars",messageLoading:"Loading results...",messageNoMatches:"No matches",messageSearchDone:'Not found? <a href="#">Try advanced search &raquo;</a>',messageErrorFull:"Error while loading results, please try again",messageError:"Error while loading",titleTemplateResult:"Admin pages"}})(jQuery);
